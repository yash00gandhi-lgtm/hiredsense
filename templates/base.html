{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{% block title %}HiredSense{% endblock %}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

<style>
  :root{
    --bg:#eef3f7;
    --card:#ffffff;
    --text:#0f172a;
    --muted:#64748b;
    --primary:#2563eb;
    --teal:#11b3b0;
    --line:rgba(15,23,42,.08);
    --shadow:0 18px 40px rgba(15,23,42,.08);
    --r:18px;
  }

  body{
    background:var(--bg);
    color:var(--text);
    font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont;
  }

  /* ===== LAYOUT ===== */
  .hs-shell{
    display:flex;
    gap:20px;
    padding:20px;
  }

  /* ===== SIDEBAR ===== */
  .hs-side{
    width:260px;
    background:var(--card);
    border-radius:var(--r);
    box-shadow:var(--shadow);
    padding:18px;
  }

  .hs-side h5{
    margin-bottom:18px;
  }

  .hs-side a{
    display:block;
    padding:10px 12px;
    border-radius:10px;
    color:var(--text);
    font-weight:500;
    text-decoration:none;
    margin-bottom:6px;
  }

  .hs-side a:hover{
    background:#f1f5f9;
  }

  /* ===== MAIN ===== */
  .hs-main{
    flex:1;
  }

  /* ===== TOPBAR ===== */
  .hs-topbar{
    background:var(--card);
    border-radius:var(--r);
    box-shadow:var(--shadow);
    padding:14px 18px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
  }

  /* ===== BUTTONS ===== */
  .hs-btn{
    border-radius:999px;
    padding:10px 18px;
    font-weight:600;
    border:0;
    cursor:pointer;
  }

  .hs-btn-primary{
    background:linear-gradient(90deg,var(--teal),var(--primary));
    color:#fff;
  }

  .hs-btn-primary:hover{
    opacity:.92;
  }

  /* ===== CARDS (dashboard use karega) ===== */
  .card{
    border:1px solid var(--line);
    border-radius:var(--r);
    box-shadow:var(--shadow);
  }

  /* ===== MODAL ===== */
  .modal-content{
    border-radius:16px;
    box-shadow:var(--shadow);
    border:0;
  }


/* ===== DASHBOARD POLISH ===== */

.hs-status{
  display:inline-flex;
  align-items:center;
  gap:6px;
  background:rgba(34,197,94,.12);
  color:#16a34a;
  padding:4px 10px;
  border-radius:999px;
  font-size:13px;
  font-weight:600;
}

.card-header{
  background:transparent;
  border-bottom:1px solid var(--line);
}

.card-header strong{
  font-weight:600;
}

.metric-card{
  transition:transform .15s ease, box-shadow .15s ease;
}

.metric-card:hover{
  transform:translateY(-2px);
  box-shadow:0 22px 50px rgba(15,23,42,.12);
}

.metric-value{
  font-size:34px;
  font-weight:700;
  margin-top:4px;
}

.metric-label{
  font-size:13px;
  color:var(--muted);
}

/* Recent list rows */
.hs-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:6px 0;
}

.hs-row a{
  font-size:13px;
  text-decoration:none;
  color:var(--primary);
}

/* Match cards */
.ats-card h5{
  font-size:17px;
  font-weight:600;
}

.ats-score{
  font-weight:600;
}

.ats-breakdown{
  background:#f8fafc;
  border-radius:10px;
  padding:8px;
  border:1px solid var(--line);
}

.badge{
  font-weight:500;
}


</style>

</head>
<body>

<div class="hs-shell">
  <aside class="hs-side">
    <h5 class="fw-bold mb-3">HiredSense</h5>
    <a class="d-block mb-2" href="/api/dashboard/">Dashboard</a>
    <a class="d-block mb-2" href="/api/resumes-ui/">Resumes</a>
    <a class="d-block mb-2" href="/api/jobs-ui/">Jobs</a>
  </aside>

  <section class="hs-main">
    <div class="hs-topbar">
      <div class="fw-semibold">{% block topbar_title %}{% endblock %}</div>
      <button id="hsNewBtn" class="hs-btn hs-btn-primary">+ New</button>
    </div>

    {% block content %}{% endblock %}
  </section>
</div>

<!-- JOB MODAL -->
<div class="modal fade" id="hsJobModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Job</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Title</label>
          <input id="hsJobTitle" class="form-control">
        </div>
        <div class="mb-3">
          <label class="form-label">Skills</label>
          <input id="hsJobSkills" class="form-control">
        </div>
        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea id="hsJobDesc" class="form-control" rows="4"></textarea>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
        <button id="hsJobSaveBtn" class="btn btn-primary">Save Job</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ================== HELPERS ================== */
function getCookie(name){
  let v="; "+document.cookie;
  let p=v.split("; "+name+"=");
  if(p.length===2) return p.pop().split(";").shift();
  return null;
}

async function hsFetch(url,opts={}){
  opts.credentials="same-origin";
  opts.headers=opts.headers||{};
  if(opts.method && opts.method!=="GET"){
    opts.headers["X-CSRFToken"]=getCookie("csrftoken");
    opts.headers["Content-Type"]="application/json";
  }
  const r=await fetch(url,opts);
  if(!r.ok) throw new Error("HTTP "+r.status);
  return r.json();
}

/* ================== SAFE NAVIGATION ================== */
/* Ye function kabhi null/undefined URL banne nahi deta */
function hsSafeRedirect(basePath, id){
  if(!id){
    console.warn("hsSafeRedirect blocked: missing id");
    return;
  }
  window.location.href = `${basePath}?${id}`;
}

/* ================== DOM READY ================== */
document.addEventListener("DOMContentLoaded",()=>{

  /* ===== + NEW BUTTON ===== */
  const newBtn = document.getElementById("hsNewBtn");
  if(newBtn){
    newBtn.onclick = () => {

      if (location.pathname.includes("jobs-ui")) {
        const m = document.getElementById("hsJobModal");
        if(m) bootstrap.Modal.getOrCreateInstance(m).show();
        return;
      }

      if (location.pathname.includes("resumes-ui")) {
        const m = document.getElementById("hsResumeModal");
        if(m) bootstrap.Modal.getOrCreateInstance(m).show();
        return;
      }
    };
  }

  /* ===== SAVE JOB ===== */
  const saveBtn = document.getElementById("hsJobSaveBtn");
  if (saveBtn) {
    saveBtn.onclick = async () => {
      const title = hsJobTitle.value.trim();
      if (!title) return alert("Title required");

      await hsFetch("/api/jobs/", {
        method: "POST",
        body: JSON.stringify({
          title,
          skills: hsJobSkills.value,
          description: hsJobDesc.value
        })
      });

      bootstrap.Modal.getInstance(hsJobModal).hide();
      location.reload();
    };
  }

});
</script>

</body>
</html>
